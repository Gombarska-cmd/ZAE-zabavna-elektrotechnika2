<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <title>Escape the Phasor ‚Äì √öloha 2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --metal-1:#4A4E52; --metal-2:#565A60; --metal-3:#2E3135;
      --cream:#FCF6E6; --grid:#C6FFFF; --grid-10:#9EEFEF;
      --ok:#22c55e; --fail:#ef4444; --hud:#111827; --hudText:#f9fafb;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background:linear-gradient(180deg,#0f1216,#171a1f);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      color:#e5e7eb;
    }

    /* R√°m */
    .frame{
      max-width:1280px;
      margin:24px auto;
      padding:16px;
      background:linear-gradient(135deg,var(--metal-2),var(--metal-3));
      border:6px solid var(--metal-1);
      border-radius:18px;
      box-shadow:0 10px 40px rgba(0,0,0,.4);
      position:relative;
    }
    .frame::before,.frame::after{
      content:"";position:absolute;width:14px;height:14px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#d6cba8 0 40%,#867f6a 60% 100%);
      box-shadow:inset 0 0 2px rgba(0,0,0,.5);
    }
    .frame::before{left:10px;top:10px}
    .frame::after{right:10px;top:10px}

    .row{display:flex;gap:16px}
    .top{align-items:center;position:relative;z-index:2}

    .panel{
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      padding:12px;
      backdrop-filter:blur(2px);
      min-height:120px;
    }
    .panel strong{display:block;margin-bottom:4px}
    .dr,.student{flex:0 0 23%}
    .task{
      flex:1;
      min-height:160px;
      position:relative;
      display:flex;
      flex-direction:column;
      padding-top:48px;
    }
    .task h2{margin:0 0 6px;font-size:18px}
    .task .scroll{overflow:auto;max-height:120px;padding-right:8px}

    /* Bublina cez cel√Ω panel */
    .bubble.wide{
      position:absolute;
      left:0;right:0;top:-10px;
      width:calc(100% - 8px);
      background:#fff;color:#111;
      border-radius:12px;
      padding:8px 36px 8px 12px;
      box-shadow:0 10px 20px rgba(0,0,0,.25);
      border:2px solid #6b4ca6;
      transform:translateY(-100%);
      font-size:14px;
    }
    .bubble.wide:after{
      content:"";position:absolute;bottom:-10px;left:40px;
      border:10px solid transparent;border-top-color:#fff;
      filter:drop-shadow(0 -2px 0 #6b4ca6);
    }
    .bubble .close{
      position:absolute;right:8px;top:2px;
      width:22px;height:22px;
      display:grid;place-items:center;
      cursor:pointer;
      border-radius:6px;
      font-weight:700;
      color:#6b4ca6;
    }
    .bubble .close:hover{background:#f2eaff}

    /* Z√°mky */
    .locks{
      display:flex;flex-direction:column;
      gap:6px;margin-top:2px;margin-left:auto;
    }
    .lock{
      width:26px;height:26px;
      border-radius:6px;
      background:#0e1218;
      border:1px solid #2a3039;
      display:grid;place-items:center;
      color:#fcd34d;
      font-size:16px;
      box-shadow:inset 0 0 6px rgba(0,0,0,.6);
    }

    /* Pl√°tno ‚Äì A4 grid */
    .play{
      margin-top:16px;
      position:relative;
      z-index:1;
    }
    /* NOV√â: grid layout */
  display:grid;
  grid-template-columns: 56% 44%;     /* pomer ƒæav√°:prav√° ‚Äì pokojne dolaƒè */
  grid-template-rows: auto 1fr auto;  /* hore text, stred voƒæn√Ω, dole answer */
  gap:14px;
  padding:18px;
}
/* v≈°eobecne zru≈° absol√∫tne poz√≠cie vo vn√∫tri gridu */
.workbench .zone{ position: static; }       /* namiesto absolute */
.zone.left{ grid-column:1; grid-row:1 / span 3; display:flex; flex-direction:column; gap:14px; }
.zone.right{ grid-column:2; grid-row:1 / span 3; display:grid; grid-template-rows:auto 1fr auto; gap:14px; }

    /* ƒΩav√Ω stƒ∫pec ‚Äì pr√≠stroje */
    .instruments{
      display:flex;
      flex-direction:column;
      gap:14px;
      padding:18px;
      position:relative;
      z-index:2;
    }

    /* Osciloskop */
    .scope2{
      flex:1;
      background:#0d0f11;
      border-radius:14px;
      padding:10px;
      box-shadow:
        inset 0 0 0 2px #2a3039,
        inset 0 0 20px rgba(0,0,0,.6);
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .osc-header{
      font-size:11px;
      color:#9ca3af;
    }
    #osc2{
      flex:1;
      width:100%;
      display:block;
      border-radius:8px;
    }

    /* Multimeter */
    .dmm{
      height:110px;
      background:#1f2933;
      border-radius:14px;
      padding:8px 10px;
      color:#e5e7eb;
      box-shadow:
        inset 0 0 0 1px #111827,
        0 4px 10px rgba(0,0,0,.35);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .dmm-top{
      display:flex;
      align-items:flex-end;
      gap:8px;
    }
    .dmm-label{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.09em;
      color:#9ca3af;
    }
    .dmm-display{
      flex:1;
      text-align:right;
      font-family:"DS-Digital","Segment7",monospace;
      font-size:26px;
      padding:4px 8px;
      background:#000;
      color:#9ef871;
      border-radius:6px;
      box-shadow:inset 0 0 6px rgba(0,0,0,.9);
    }
    .dmm-unit{
      font-size:13px;
      font-weight:600;
      margin-left:2px;
    }
    .dmm-hints{
      display:flex;
      gap:6px;
      font-size:9px;
      text-transform:uppercase;
      color:#9ca3af;
    }
    .dmm-hints span{
      padding:2px 6px;
      border-radius:999px;
      border:1px solid #374151;
    }

    /* Prav√° strana ‚Äì zadanie a odpovede */
    .taskBox{
      position:absolute;
      left:18px;right:18px;
      top:18px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      padding:10px 12px;
      color:#111;
      box-shadow:0 3px 8px rgba(0,0,0,.06);
      font-size:14px;
    }
    .taskBox .line{margin:2px 0}
    .taskBox .small{font-size:12px;opacity:.9}

    .answerBox{
      position:absolute;
      left:18px;right:18px;
      bottom:18px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      padding:10px 12px;
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
      color:#111;
      box-shadow:0 3px 8px rgba(0,0,0,.06);
      z-index:3;
    }
    .answerBox label{
      display:flex;
      align-items:center;
      gap:4px;
      font-size:14px;
    }
    .answerBox input{
      width:90px;
      padding:6px 8px;
      border-radius:8px;
      border:1px solid #cbd5e1;
      font-size:14px;
    }
    .answerBox button{
      padding:8px 14px;
      border-radius:10px;
      border:1px solid #111827;
      background:#111827;
      color:#f9fafb;
      cursor:pointer;
      font-size:14px;
    }
    .answerBox button:hover{background:#020817}
    .feedback{
      min-width:160px;
      font-weight:600;
      font-size:13px;
    }

    /* HUD */
    .hud{
      margin-top:12px;
      padding:10px 12px;
      background:var(--hud);
      color:var(--hudText);
      border-radius:var(--radius);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .hud .group{display:flex;gap:14px;align-items:center}
    .pill{
      background:#020817;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #374151;
      font-size:13px;
    }
    .hud select{
      background:#020817;
      color:#f9fafb;
      border:1px solid #374151;
      border-radius:8px;
      padding:3px 6px;
      font-size:13px;
    }

    /* Typografia */
    .math var{font-style:italic}
    .math sub{font-style:normal}
    .phi{font-family:"Cambria Math","STIX Two Math","DejaVu Sans",serif}

    /* Efekty */
    .shake{animation:shake .35s}
    .flash{animation:flash .35s}
    @keyframes shake{
      0%,100%{transform:translateX(0)}
      20%{transform:translateX(-5px)}
      40%{transform:translateX(5px)}
      60%{transform:translateX(-3px)}
      80%{transform:translateX(3px)}
    }
    @keyframes flash{
      0%{background-color:#fee2e2}
      100%{background-color:transparent}
    }

    /* Iskra pri √∫spechu (pou≈æijeme pri odomknut√≠) */
    .spark{
      position:absolute;
      width:140px;height:140px;
      pointer-events:none;
      display:none;
      background:
        radial-gradient(circle at 50% 50%,#FFD745 0 30%,rgba(255,215,69,.6) 35% 55%,transparent 60%),
        conic-gradient(from 0deg,rgba(255,215,69,.95),rgba(243,190,87,.6),rgba(255,237,154,.8),rgba(255,215,69,.95));
      filter:blur(1px) drop-shadow(0 0 10px rgba(255,215,69,.7));
      border-radius:50%;
      transform:translate(-50%,-50%) scale(.8);
      animation:spark .6s ease-out forwards;
    }
    @keyframes spark{
      0%{opacity:0;transform:translate(-50%,-50%) scale(.4) rotate(0deg)}
      20%{opacity:1;transform:translate(-50%,-50%) scale(1.05) rotate(12deg)}
      100%{opacity:0;transform:translate(-50%,-50%) scale(1.1) rotate(22deg)}
    }
  </style>
</head>
<body>
  <main class="frame">
    <!-- Horn√Ω rad -->
    <section class="row top">
      <div class="panel dr" id="dr"><strong>Dr. Phasor</strong></div>

      <div class="panel task" id="taskPanel">
        <div class="bubble wide" id="bubble">
          MUHAHA! Nov√© zadanie ƒçak√°‚Ä¶
          <div class="close" id="bubbleClose">√ó</div>
        </div>
        <h2>√öloha 2 ‚Äì Maxim√°lna a efekt√≠vna hodnota</h2>
        <div class="scroll math" id="taskText">
          Zosn√≠mal som striedav√© nap√§tie na osciloskope a z√°rove≈à som ho zmeral True RMS multimetrom.
          Z t√Ωchto √∫dajov urƒçi maxim√°lnu hodnotu <var>U</var><sub>m</sub> a efekt√≠vnu hodnotu <var>U</var>.
        </div>
      </div>

      <div class="panel student">
        <strong>≈†tudent</strong>
        <div class="locks" id="locksCol">
          <div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div>
          <div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div>
        </div>
      </div>
    </section>

    <!-- Pl√°tno ‚Äì √öloha 2 -->
    <section class="play">
      <div class="workbench">
        <!-- ƒΩAVO: osciloskop + multimeter -->
        <div class="zone left instruments">
          <div class="scope2">
            <div class="osc-header">Osciloskop ‚Äì priebeh u(t)</div>
            <canvas id="osc2"></canvas>
          </div>

          <div class="dmm">
            <div class="dmm-top">
              <div class="dmm-label">True RMS multimeter</div>
              <div class="dmm-display" id="dmmDisplay">230.0</div>
              <div class="dmm-unit">V</div>
            </div>
            <div class="dmm-hints">
              <span>AC</span><span>RMS</span>
            </div>
          </div>
        </div>

        <!-- PRAVO: zadanie a odpoveƒè -->
        <div class="zone right">
          <div class="taskBox math" id="taskBox2">
            <div class="line"><strong>Zadanie:</strong> Z oscilogramu a √∫dajov multimetra urƒç:</div>
            <div class="line">&nbsp;&nbsp;1. Maxim√°lnu hodnotu <var>U</var><sub>m</sub></div>
            <div class="line">&nbsp;&nbsp;2. Efekt√≠vnu hodnotu <var>U</var></div>
            <div class="line small">
              Multimeter zobrazuje efekt√≠vnu hodnotu <var>U</var>.
              Pre s√≠nusov√Ω priebeh plat√≠:
              <var>U</var><sub>m</sub> = ‚àö2 ¬∑ <var>U</var>.
            </div>
          </div>

          <div class="answerBox">
            <label><var>U</var><sub>m</sub> =
              <input id="uMax" type="number" step="0.1" placeholder="V">
              <span>V</span>
            </label>
            <label><var>U</var> =
              <input id="uEff" type="number" step="0.1" placeholder="V">
              <span>V</span>
            </label>
            <button id="checkTask2">Skontrolova≈•</button>
            <div id="feedback2" class="feedback"></div>
          </div>
        </div>

        <div id="spark" class="spark" aria-hidden="true"></div>
      </div>
    </section>

    <!-- HUD -->
    <section class="hud">
      <div class="group">
        <span class="pill" id="timePill">TIME: 00:00</span>
        <span class="pill">
          MODE:
          <select id="modeSelect">
            <option value="EASY" selected>EASY</option>
            <option value="MEDIUM">MEDIUM</option>
            <option value="HARD">HARD</option>
          </select>
        </span>
        <span class="pill" id="mistakesPill">MISTAKES: 0/2</span>
        <span class="pill" id="locksPill">LOCKS LEFT: 10</span>
      </div>
      <div class="group">
        <span class="pill">√öLOHA 2 ‚Äì U<sub>m</sub>, U</span>
      </div>
    </section>
  </main>

  <script>
    // zavretie MUHAHA bubliny
    document.getElementById('bubbleClose').addEventListener('click', () => {
      document.getElementById('bubble').style.display = 'none';
    });

    const TAU = Math.PI * 2;
    const randFrom = arr => arr[Math.floor(Math.random()*arr.length)];

    const pills = {
      time: document.getElementById('timePill'),
      mistakes: document.getElementById('mistakesPill'),
      locks: document.getElementById('locksPill')
    };

    const state = {
      mode: 'EASY',
      mistakes: 0,
      Ueff: 230,
      Um: Math.SQRT2 * 230
    };

    const el = {
      osc: document.getElementById('osc2'),
      dmm: document.getElementById('dmmDisplay'),
      uMax: document.getElementById('uMax'),
      uEff: document.getElementById('uEff'),
      check: document.getElementById('checkTask2'),
      fb: document.getElementById('feedback2'),
      locksCol: document.getElementById('locksCol'),
      bubble: document.getElementById('bubble'),
      taskPanel: document.getElementById('taskPanel'),
      taskText: document.getElementById('taskText'),
      spark: document.getElementById('spark'),
      modeSelect: document.getElementById('modeSelect')
    };

    let startTs = Date.now();
    let oscCtx, oscW, oscH, DPR;

    function tol() {
      return state.mode === 'EASY' ? 0.2
           : state.mode === 'MEDIUM' ? 0.1
           : 0.05;
    }

    /* ========== Zadanie ========== */
    function newTask2() {
      state.mistakes = 0;

      // n√°hodn√Ω RMS
      state.Ueff = randFrom([40, 60, 120, 230]);
      state.Um   = Math.SQRT2 * state.Ueff;

      el.dmm.textContent = state.Ueff.toFixed(1);

      el.uMax.value = '';
      el.uEff.value = '';
      el.fb.textContent = '';
      el.fb.style.color = '#111';

      // text zadania upresni
      el.taskText.innerHTML =
        `Z osciloskopu odƒç√≠ta≈° ≈°piƒçku nap√§tia a z multimetra efekt√≠vnu hodnotu. ` +
        `Pre aktu√°lne meranie multimeter ukazuje ${state.Ueff.toFixed(1)} V. ` +
        `Urƒçi maxim√°lnu hodnotu <var>U</var><sub>m</sub> a efekt√≠vnu hodnotu <var>U</var>. ` +
        `Pre s√≠nus: <var>U</var><sub>m</sub> = ‚àö2 ¬∑ <var>U</var>.`;

      drawOsc2();
      updateHud();
    }

    /* ========== Osciloskop ========== */
    function resizeOsc2() {
      DPR = window.devicePixelRatio || 1;
      const r = el.osc.getBoundingClientRect();
      oscW = Math.max(200, Math.floor(r.width * DPR));
      oscH = Math.max(120, Math.floor(r.height * DPR));
      el.osc.width = oscW;
      el.osc.height = oscH;
      oscCtx = el.osc.getContext('2d');
    }

    function drawOsc2() {
      if (!oscCtx) resizeOsc2();
      const W = oscW / DPR;
      const H = oscH / DPR;

      oscCtx.save();
      oscCtx.scale(DPR, DPR);
      oscCtx.clearRect(0,0,W,H);

      const G = 14;
      const PAD = 2 * G;
      const xmin = PAD, xmax = W - PAD;
      const ymin = PAD, ymax = H - PAD;
      const midX = (xmin + xmax)/2;
      const midY = (ymin + ymax)/2;

      // mrie≈æka
      oscCtx.lineWidth = 1;
      oscCtx.strokeStyle = 'rgba(255,255,255,0.18)';
      for (let x = Math.ceil(xmin/G)*G; x <= xmax; x += G){
        oscCtx.beginPath(); oscCtx.moveTo(x,ymin); oscCtx.lineTo(x,ymax); oscCtx.stroke();
      }
      for (let y = Math.ceil(ymin/G)*G; y <= ymax; y += G){
        oscCtx.beginPath(); oscCtx.moveTo(xmin,y); oscCtx.lineTo(xmax,y); oscCtx.stroke();
      }
      const G10 = G*10;
      oscCtx.strokeStyle = 'rgba(255,255,255,0.32)';
      oscCtx.lineWidth = 1.3;
      for (let x = Math.ceil(xmin/G10)*G10; x <= xmax; x += G10){
        oscCtx.beginPath(); oscCtx.moveTo(x,ymin); oscCtx.lineTo(x,ymax); oscCtx.stroke();
      }
      for (let y = Math.ceil(ymin/G10)*G10; y <= ymax; y += G10){
        oscCtx.beginPath(); oscCtx.moveTo(xmin,y); oscCtx.lineTo(xmax,y); oscCtx.stroke();
      }

      // osi
      oscCtx.strokeStyle = '#f9fafb';
      oscCtx.lineWidth = 2.4;
      oscCtx.beginPath(); oscCtx.moveTo(xmin,midY); oscCtx.lineTo(xmax,midY); oscCtx.stroke();
      oscCtx.beginPath(); oscCtx.moveTo(midX,ymin); oscCtx.lineTo(midX,ymax); oscCtx.stroke();

      // s√≠nusovka
      const T = 1/50; // 50 Hz len vizu√°lne
      const viewT = 2*T;
      const tToX = t => xmin + (t/viewT)*(xmax-xmin);
      const A = (ymax-ymin)*0.32;
      const w = TAU*50;
      const phi = 0;

      oscCtx.strokeStyle = '#22c55e';
      oscCtx.lineWidth = 2.2;
      oscCtx.beginPath();
      const steps = Math.max(260, Math.floor(xmax-xmin));
      for (let i=0;i<=steps;i++){
        const x = xmin + (i/steps)*(xmax-xmin);
        const t = ((x-xmin)/(xmax-xmin))*viewT;
        const y = midY - A*Math.sin(w*t + phi);
        if(i===0) oscCtx.moveTo(x,y); else oscCtx.lineTo(x,y);
      }
      oscCtx.stroke();

      oscCtx.restore();
    }

    window.addEventListener('resize', () => { resizeOsc2(); drawOsc2(); });

    /* ========== Kontrola ========== */
    function dropOneLock(){
      const locks = el.locksCol.querySelectorAll('.lock');
      if (locks.length){
        locks[0].remove();
      }
    }

    function successSpark(){
      const drRect = document.getElementById('dr').getBoundingClientRect();
      const frameRect = document.querySelector('.frame').getBoundingClientRect();
      el.spark.style.display = 'block';
      el.spark.style.left = (drRect.right - frameRect.left - 10) + 'px';
      el.spark.style.top  = (drRect.top   - frameRect.top  + 40) + 'px';
      el.spark.classList.remove('spark');
      void el.spark.offsetWidth;
      el.spark.classList.add('spark');
      setTimeout(()=>{ el.spark.style.display='none'; }, 650);
    }

    function showMuhaha(){
      el.bubble.style.display = 'block';
      el.bubble.firstChild.textContent = 'MUHAHA! Nov√© zadanie... ';
    }

    function failFeedback(){
      el.taskPanel.classList.add('shake','flash');
      setTimeout(()=>el.taskPanel.classList.remove('shake','flash'),400);
    }

    el.check.addEventListener('click', () => {
      const valUm = parseFloat(el.uMax.value.replace(',','.'));
      const valU  = parseFloat(el.uEff.value.replace(',','.'));

      if(isNaN(valUm) || isNaN(valU)){
        el.fb.textContent = 'Zadaj obe hodnoty v voltoch.';
        el.fb.style.color = '#b91c1c';
        return;
      }

      const corrUm = state.Um;
      const corrU  = state.Ueff;
      const t = tol();

      const okUm = Math.abs(valUm - corrUm) <= t;
      const okU  = Math.abs(valU  - corrU ) <= t;

      if(okUm && okU){
        el.fb.textContent =
          `Spr√°vne! U‚Çò ‚âà ${corrUm.toFixed(2)} V, U ‚âà ${corrU.toFixed(2)} V.`;
        el.fb.style.color = '#15803d';
        dropOneLock();
        successSpark();
        newTask2();
        return;
      }

      // chyba
      state.mistakes++;
      failFeedback();

      if(state.mode === 'EASY' && state.mistakes === 1){
        el.fb.textContent =
          'N√°poveda: Multimeter ukazuje U. Pre s√≠nus plat√≠ U‚Çò = ‚àö2¬∑U.';
        el.fb.style.color = '#92400e';
      }else if(state.mistakes >= 2){
        el.fb.textContent =
          `MUHAHA! Spr√°vne bolo: U‚Çò ‚âà ${corrUm.toFixed(2)} V, U ‚âà ${corrU.toFixed(2)} V. Nov√© zadanie!`;
        el.fb.style.color = '#b91c1c';
        dropOneLock();
        showMuhaha();
        newTask2();
      }else{
        el.fb.textContent = 'Nieƒço nesed√≠. Sk√∫s znova.';
        el.fb.style.color = '#b91c1c';
      }

      updateHud();
    });

    /* ========== HUD, m√≥d, ƒças ========== */
    function updateHud(){
      const left = el.locksCol.querySelectorAll('.lock').length;
      pills.mistakes.textContent = `MISTAKES: ${state.mistakes}/2`;
      pills.locks.textContent    = `LOCKS LEFT: ${left}`;
    }

    el.modeSelect.addEventListener('change', e => {
      state.mode = e.target.value;
    });

    setInterval(() => {
      const s = Math.floor((Date.now() - startTs)/1000);
      const m = String(Math.floor(s/60)).padStart(2,'0');
      const ss = String(s%60).padStart(2,'0');
      pills.time.textContent = `TIME: ${m}:${ss}`;
    }, 1000);

    /* ========== ≈†tart ========== */
    function boot(){
      resizeOsc2();
      newTask2();
      updateHud();
    }
    boot();
  </script>
</body>
</html>
