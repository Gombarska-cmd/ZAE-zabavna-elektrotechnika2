<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <title>Escape the Phasor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --metal-1:#4A4E52; --metal-2:#565A60; --metal-3:#2E3135;
      --cream:#FCF6E6; --grid:#C6FFFF; --grid-10:#9EEFEF;
      --ok:#22c55e; --fail:#ef4444; --hud:#111827; --hudText:#f9fafb;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:linear-gradient(180deg,#020817,#111827);
      color:#e5e7eb;
    }

    /* R√ÅM */
    .frame{
      max-width:1280px;margin:24px auto;padding:16px;
      background:linear-gradient(135deg,var(--metal-2),var(--metal-3));
      border:6px solid var(--metal-1);border-radius:18px;
      box-shadow:0 10px 40px rgba(0,0,0,.4);position:relative;
    }
    .frame::before,.frame::after{
      content:"";position:absolute;width:14px;height:14px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#d6cba8 0 40%,#867f6a 60 100%);
      box-shadow:inset 0 0 2px rgba(0,0,0,.6)
    }
    .frame::before{left:10px;top:10px}
    .frame::after{right:10px;top:10px}

    .row{display:flex;gap:16px}
    .top{align-items:center;position:relative;z-index:2}

    /* horn√© panely */
    .panel{
      background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);padding:12px;
      backdrop-filter:blur(2px);min-height:120px;
    }
    .panel strong{display:block;margin-bottom:4px}
    .dr,.student{flex:0 0 23%}
    .task{
      flex:1;min-height:160px;position:relative;display:flex;
      flex-direction:column;padding-top:48px;
    }
    .task h2{margin:0 0 8px 0;font-size:18px}
    .task .scroll{overflow:auto;max-height:120px;padding-right:8px}

    /* bublina */
    .bubble.wide{
      position:absolute;left:0;right:0;top:-10px;width:calc(100% - 8px);
      background:#fff;color:#111827;border-radius:12px;
      padding:10px 36px 10px 12px;
      box-shadow:0 10px 20px rgba(0,0,0,.25);
      border:2px solid #6b4ca6;transform:translateY(-100%);
    }
    .bubble.wide:after{
      content:"";position:absolute;bottom:-10px;left:40px;
      border:10px solid transparent;border-top-color:#fff;
      filter:drop-shadow(0 -2px 0 #6b4ca6);
    }
    .bubble .close{
      position:absolute;right:8px;top:4px;width:24px;height:24px;
      display:grid;place-items:center;cursor:pointer;border-radius:6px;
      font-weight:700;color:#6b4ca6;
    }
    .bubble .close:hover{background:#f2eaff}

    .locks{display:flex;flex-direction:column;gap:6px;margin-left:auto}
    .lock{
      width:26px;height:26px;border-radius:6px;
      background:#020817;border:1px solid #374151;
      display:grid;place-items:center;color:#fbbf24;font-size:16px;
      box-shadow:inset 0 0 6px rgba(0,0,0,.7)
    }

    /* prep√≠naƒç √∫loh */
    .task-switch{
      display:flex;gap:8px;margin-bottom:10px;
    }
    .task-switch button{
      padding:6px 12px;border-radius:999px;border:1px solid #1f2937;
      background:#020617;color:#e5e7eb;cursor:pointer;font-weight:600;
    }
    .task-switch button.active{
      background:#22c55e;border-color:#15803d;color:#022c22;
    }

    /* spoloƒçn√© pl√°tno */
    .play{margin-top:16px;position:relative;z-index:1}
    .workbench{
      width:100%;aspect-ratio:16/9;min-height:420px;
      background:var(--cream);border:1px solid rgba(0,0,0,.12);
      border-radius:var(--radius);position:relative;overflow:hidden;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.04)
    }
    @media (max-width:1280px){.workbench{min-height:360px}}
    .workbench::before{
      content:"";position:absolute;inset:0;background:
        repeating-linear-gradient(0deg,var(--grid) 0 1px,transparent 1px 20px),
        repeating-linear-gradient(90deg,var(--grid) 0 1px,transparent 1px 20px),
        repeating-linear-gradient(0deg,transparent 0 200px,var(--grid-10) 200px 201px,transparent 201px 400px),
        repeating-linear-gradient(90deg,transparent 0 200px,var(--grid-10) 200px 201px,transparent 201px 400px);
      opacity:.45;pointer-events:none;
    }
    .zone{position:absolute;top:0;bottom:0}
    .zone.left{left:0;width:50%}
    .zone.right{right:0;width:50%}

    /* prep√≠nanie obrazoviek */
    .task-screen{display:none}
    .task-screen.active{display:block}

    /* √öLOHA 1 ‚Äì osciloskop + kalkulaƒçka */

    .scope{
      position:absolute;top:18px;left:18px;right:18px;bottom:82px;
      background:#0d0f11;border-radius:14px;padding:10px;
      box-shadow:inset 0 0 0 2px #2a3039,inset 0 0 20px rgba(0,0,0,.6);
    }
    #osc{width:100%;height:100%;display:block;border-radius:10px}

    .osc-ui{
      position:absolute;left:18px;right:18px;bottom:18px;
      display:flex;gap:16px;align-items:center;
      padding:8px 10px;border-radius:10px;
      background:rgba(0,0,0,.08);
      border:1px solid rgba(15,23,42,.3);
      backdrop-filter:blur(1px);color:#111827;
    }
    #playBtn{
      padding:6px 10px;border-radius:8px;border:1px solid #111827;
      background:#111827;color:#f9fafb;cursor:pointer;
    }
    #playBtn.paused{opacity:.7}
    .osc-ui input[type="range"]{width:220px;margin:0 8px}

    /* KALKULAƒåKA ‚Äì √öLOHA 1 */
    .calc{
      position:absolute;
      top:18px;left:18px;right:18px;bottom:82px;
      background:rgba(255,255,255,.78);
      border:1px solid rgba(0,0,0,.1);
      border-radius:12px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      box-shadow:0 3px 10px rgba(0,0,0,.08);
      color:#111827;
    }
    #calcDisplay{
      width:100%;
      padding:8px 10px;
      border:2px solid #cbd5e1;
      border-radius:8px;
      font-size:32px;
    }
    .calc-grid{
      flex:1;
      display:grid;
      grid-template-columns:repeat(5,1fr);
      grid-template-rows:repeat(6,1fr);
      gap:6px;
    }
    .calc-grid button{
      width:100%;
      height:100%;
      border:2px solid #d4d4d8;
      border-radius:10px;
      background:#f4f4f5;
      cursor:pointer;
      font-weight:700;
      font-size:16px;
    }
    .calc-grid button.ghost{background:#e5e7eb}
    .calc-grid button.emph{
      background:#111827;
      color:#f9fafb;
      border-color:#111827;
    }
    .calc-grid button.wide{grid-column:span 2}

    /* odpoveƒè ‚Äì √∫loha 1 */
    .answerBox{
      position:absolute;
      left:18px;right:18px;bottom:18px;
      background:rgba(255,255,255,.9);
      border:1px solid rgba(0,0,0,.1);
      border-radius:12px;
      padding:10px 12px;
      display:flex;align-items:center;gap:10px;flex-wrap:wrap;
      color:#111;box-shadow:0 3px 8px rgba(0,0,0,.06);
    }
    .answerBox input{
      width:180px;padding:8px 10px;border-radius:8px;border:1px solid #cbd5e1;
    }
    .answerBox button{
      padding:8px 14px;border-radius:10px;border:1px solid #111827;
      background:#111827;color:#f9fafb;cursor:pointer;
    }
    .feedback{min-height:1.2em;font-weight:700}

    /* HUD */
    .hud{
      margin-top:12px;padding:10px 12px;background:var(--hud);color:var(--hudText);
      border-radius:var(--radius);display:flex;flex-wrap:wrap;gap:10px;
      align-items:center;justify-content:space-between;position:relative;z-index:3;
      font-size:14px;
    }
    .hud .group{display:flex;gap:14px;align-items:center}
    .pill{
      background:#020817;padding:6px 10px;border-radius:999px;
      border:1px solid #374151;
    }
    .hud select{
      background:#020817;color:#f9fafb;border:1px solid #374151;
      border-radius:8px;padding:3px 6px;
    }
    #hintBtn{display:none;} /* tlaƒçidlo je skryt√©, pou≈æ√≠vame len hintText */

    /* TYPO + EFEKTY */
    .math var{font-style:italic}
    .math sub{font-style:normal}
    .psi{font-family:"Cambria Math","STIX Two Math","DejaVu Sans",serif}
    .shake{animation:shake .35s}
    .flash{animation:flash .4s}
    @keyframes shake{
      0%,100%{transform:translateX(0)}
      20%{transform:translateX(-6px)}
      40%{transform:translateX(6px)}
      60%{transform:translateX(-4px)}
      80%{transform:translateX(4px)}
    }
    @keyframes flash{
      0%{background:#2b1111}
      100%{background:transparent}
    }

    .spark{
      position:absolute;width:160px;height:160px;pointer-events:none;display:none;
      background:
        radial-gradient(circle at 50% 50%,#FFD745 0 30%,rgba(255,215,69,.6) 35% 55%,transparent 60%),
        conic-gradient(from 0deg,rgba(255,215,69,.9),rgba(243,190,87,.6),rgba(255,237,154,.7),rgba(255,215,69,.9));
      filter:blur(1px) drop-shadow(0 0 10px rgba(255,215,69,.7));
      border-radius:50%;
      transform:translate(-50%,-50%) scale(.8);
      animation:spark .6s ease-out forwards;
    }

    /* √öLOHA 2 ‚Äì layout tak, ako si chcela */
    .t2-wrap{
      display:grid;grid-template-columns:50% 50%;gap:16px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;padding:16px;
    }
    .t2-card{
      background:rgba(0,0,0,.15);border:1px solid rgba(255,255,255,.12);
      border-radius:12px;padding:12px;color:#e5e7eb;
    }
    .t2-h{font-weight:800;margin:0 0 8px 0}

    .scope2,.dmm{
      position:relative;border-radius:12px;padding:12px;
      background:#0d0f11;border:1px solid #2a3039;
      box-shadow:inset 0 0 20px rgba(0,0,0,.6);
    }
    .scope-screen{
      height:170px;border-radius:8px;background:#0a0f12;
      position:relative;overflow:hidden;
    }
    .scope-screen::before{
      content:"";position:absolute;inset:0;background:
      repeating-linear-gradient(0deg,rgba(255,255,255,.10) 0 1px,transparent 1px 20px),
      repeating-linear-gradient(90deg,rgba(255,255,255,.10) 0 1px,transparent 1px 20px);
      opacity:.55;
    }
    .dmm-face{
      display:grid;grid-template-columns:1fr 140px;gap:12px;align-items:center;
    }
    .dmm-reading{
      font:700 42px/1.1 monospace;background:#c9f0d8;color:#0b2c15;
      padding:8px 12px;border-radius:8px;
      box-shadow:inset 0 0 4px rgba(0,0,0,.25);
    }
    .selector{
      width:120px;height:120px;border-radius:50%;margin:auto;
      background:radial-gradient(#444 0 38%,#26292f 40 100%);
      position:relative;border:2px solid #1f2430;
      box-shadow:inset 0 8px 18px rgba(0,0,0,.35);
    }
    .selector::after{
      content:"";position:absolute;left:50%;top:50%;
      width:6px;height:38px;background:#e5e7eb;border-radius:3px;
      transform-origin:50% 90%;
      transform:translate(-50%,-90%) rotate(var(--angle,-20deg));
    }
    .sel-row{display:flex;justify-content:space-between;font-size:12px;color:#cbd5e1;margin-top:6px}
    .sel-btn{
      padding:4px 6px;border:1px solid #3a4150;border-radius:6px;
      background:#161b25;color:#e5e7eb;cursor:pointer;
    }
    .sel-btn.active{outline:2px solid #22c55e}

    .jacks{display:flex;gap:8px;margin-top:8px}
    .jack{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 8px;border-radius:999px;
      background:#111827;border:1px solid #374151;
      color:#f8fafc;cursor:grab;
    }
    .jack .dot{width:10px;height:10px;border-radius:50%}
    .jack.red .dot{background:#ef4444}
    .jack.black .dot{background:#6b7280}
    .jack.amper .dot{background:#f59e0b}

    .circuit{
      position:relative;border-radius:12px;background:var(--cream);
      padding:14px 14px 52px 14px;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .lamp{
      width:130px;height:130px;border-radius:50%;
      margin:14px auto 8px;
      background:radial-gradient(circle at 50% 45%,#ffe69a 0 45%,
                 #ffd24d 46 58%,#f0b02a 59 65%,#cc9000 66 100%);
    }
    .lamp.off{filter:grayscale(1) brightness(.75)}

    .terminal{
      position:absolute;width:24px;height:24px;border-radius:50%;
      background:#222;border:2px solid #ddd;cursor:pointer;
      z-index:4;
    }
    .tA{left:calc(50% - 70px);top:24px}
    .tB{left:calc(50% + 46px);top:24px}

    .termLabel{
      position:absolute;font-weight:700;font-size:13px;color:#111827;
      top:8px;
    }
    .labA{left:calc(50% - 70px);}
    .labB{left:calc(50% + 50px);}

    .source{
      position:absolute;left:50%;transform:translateX(-50%);
      bottom:10px;width:260px;height:60px;border-radius:10px;
      background:linear-gradient(90deg,#e8eef6 0 60%,#cbd5e1 60 100%);
      border:2px solid #93a3b8;
      display:flex;align-items:center;justify-content:space-around;
    }
    .src-post{width:18px;height:18px;border-radius:50%;border:2px solid #111}
    .src-post.pos{background:#ffdddd;border-color:#b91c1c}
    .src-post.neg{background:#dde9ff;border-color:#1d4ed8}

    .t2-btn{
      position:absolute;right:12px;bottom:10px;
      padding:6px 10px;border-radius:8px;
      border:1px solid #374151;background:#111827;
      color:#f8fafc;cursor:pointer;
    }

    .dropzone{
      margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;
      min-height:38px;padding:6px;border-radius:8px;
      border:1px dashed rgba(255,255,255,.35);
    }
    .dz-ok{border-color:#22c55e}
    .dz-bad{border-color:#ef4444}
    .token{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      background:#fff;color:#111;border:1px solid #cbd5e1;
      font-weight:700;cursor:grab;
      margin:2px;
    }
    .tray{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}

    /* √öLOHA 3 ‚Äì graf + f√°zor (nov√© rozlo≈æenie) */
    .t3-cols{
      position:absolute;
      inset:18px;
      display:flex;
      gap:16px;
    }
    .t3-waveBox,
    .t3-phasorBox{
      flex:1;
      background:#020617;
      border-radius:14px;
      padding:10px 12px;
      box-shadow:inset 0 0 0 2px #1f2933,inset 0 0 18px rgba(0,0,0,.7);
      color:#e5e7eb;
      display:flex;
      flex-direction:column;
    }
    .t3-title{
      font-weight:700;font-size:14px;margin-bottom:4px;
    }
    .t3-plot{
      position:relative;
      flex:1;
      margin-top:4px;
      border-radius:10px;
      background:#020617;
      overflow:hidden;
    }
    #t3-wave{
      width:100%;height:100%;display:block;
    }
    .t3-axes-labels{
      position:absolute;
      inset:auto 10px 4px 10px;
      display:flex;justify-content:space-between;
      font-size:12px;color:#cbd5e1;
      pointer-events:none;
    }
    .t3-cursor-v,
    .t3-cursor-h{
      position:absolute;
      pointer-events:auto;
    }
    .t3-cursor-v{
      top:0;bottom:0;width:1px;
      background:rgba(251,191,36,.85);
      cursor:ew-resize;
    }
    .t3-cursor-h{
      left:0;right:0;height:1px;
      background:rgba(96,165,250,.85);
      cursor:ns-resize;
    }
    .t3-tag{
      position:absolute;
      background:rgba(15,23,42,.95);
      color:#e5e7eb;
      padding:2px 6px;
      border-radius:6px;
      font-size:11px;
      border:1px solid rgba(148,163,184,.9);
      white-space:nowrap;
    }
    .t3-cursor-v .t3-tag{
      top:4px;transform:translateX(-50%);
    }
    .t3-cursor-h .t3-tag{
      right:4px;transform:translateY(-50%);
    }

    .t3-phasorBox canvas{
      border-radius:10px;
      background:#020617;
      height:220px;
    }
    .t3-sliders{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:13px;
      margin-top:6px;
    }
    .t3-sliders label{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }
    .t3-sliders input[type="range"]{
      flex:1;
    }
    .t3-sliders input[type="number"]{
      width:72px;
      padding:4px 6px;
      border-radius:6px;
      border:1px solid #4b5563;
      background:#020617;
      color:#e5e7eb;
    }
    .t3-checkBtn{
      margin-top:6px;
      align-self:flex-start;
      padding:6px 12px;
      border-radius:10px;
      border:1px solid #22c55e;
      background:#16a34a;
      color:#022c22;
      font-weight:600;
      cursor:pointer;
    }
    .t3-feedback{
      min-height:1.4em;
      font-weight:700;
      margin-top:4px;
      font-size:13px;
    }
  </style>
</head>
<body>
  <main class="frame">

    <!-- prep√≠naƒç √∫loh -->
    <div class="task-switch">
      <button id="btnTask1" class="active" onclick="showTask('task1')">√öloha 1</button>
      <button id="btnTask2" onclick="showTask('task2')">√öloha 2</button>
      <button id="btnTask3" onclick="showTask('task3')">√öloha 3</button>
    </div>

    <!-- horn√Ω rad -->
    <section class="row top">
      <div class="panel dr" id="dr"><strong>Dr. Phasor</strong></div>

      <div class="panel task" id="taskPanel">
        <div class="bubble wide" id="bubble">
          MUHAHA! Nov√© zadanie ƒçak√°‚Ä¶
          <div class="close" id="bubbleClose">√ó</div>
        </div>
        <h2>√öloha</h2>
        <div class="scroll math" id="taskText"></div>
      </div>

      <div class="panel student">
        <strong>≈†tudent</strong>
        <div class="locks" id="locksCol">
          <div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div>
          <div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div><div class="lock">üîí</div>
        </div>
      </div>
    </section>

    <!-- √öLOHA 1 -->
    <section id="task1" class="task-screen active">
      <section class="play">
        <div class="workbench">
          <!-- ƒæavo: osciloskop -->
          <div class="zone left">
            <div class="scope">
              <canvas id="osc" aria-label="osciloskop"></canvas>
            </div>
            <div class="osc-ui">
              <button id="playBtn" type="button">‚ñ∂Ô∏é Play</button>
              <label>ƒåas <var>t</var>:
                <input id="tSlider" type="range" min="0" max="20" step="0.1" value="2">
                <span id="tReadout">2.0 ms</span>
              </label>
            </div>
          </div>

          <!-- pravo: kalkulaƒçka + odpoveƒè -->
          <div class="zone right">
            <div class="calc">
              <input id="calcDisplay" type="text" inputmode="decimal"
                     autocomplete="off" spellcheck="false" />

              <div class="calc-grid">
                <!-- riadok 1 -->
                <button data-fn="tenpow">10À£</button>
                <button data-fn="pi">œÄ</button>
                <button data-fn="clear">C</button>
                <button data-fn="back">‚å´</button>
                <button id="degRad" data-fn="mode">RAD</button>

                <!-- riadok 2 -->
                <button data-op="(">(</button>
                <button data-op=")">)</button>
                <button data-fn="sqrt">‚àö</button>
                <button data-fn="sin">sin</button>
                <button data-op="/">√∑</button>

                <!-- riadok 3 -->
                <button data-num="7">7</button>
                <button data-num="8">8</button>
                <button data-num="9">9</button>
                <button data-fn="cos">cos</button>
                <button data-op="*">√ó</button>

                <!-- riadok 4 -->
                <button data-num="4">4</button>
                <button data-num="5">5</button>
                <button data-num="6">6</button>
                <button data-fn="tan">tan</button>
                <button data-op="-">-</button>

                <!-- riadok 5 -->
                <button data-num="1">1</button>
                <button data-num="2">2</button>
                <button data-num="3">3</button>
                <button data-fn="pm">+/‚àí</button>
                <button data-op="+">+</button>

                <!-- riadok 6 -->
                <button data-num="0" class="wide">0</button>
                <button data-op=",">,</button>
                <button data-fn="ans" class="ghost">‚Üí Odpoveƒè</button>
                <button data-fn="eq" class="emph">=</button>
              </div>
            </div>

            <div class="answerBox">
              <label>Odpoveƒè: <var>u</var>(<var>t</var>) =
                <input id="answer" type="number" step="0.01" placeholder="V" />
                <span>V</span>
              </label>
              <button id="checkBtn">Skontrolova≈•</button>
              <div id="feedback" class="feedback"></div>
            </div>
          </div>
        </div>
        <div id="spark" class="spark" aria-hidden="true"></div>
      </section>
    </section>

    <!-- √öLOHA 2 ‚Äì MERANIE U(t), Um, U -->
    <section id="task2" class="task-screen">
      <div class="t2-wrap" id="t2">

        <!-- ƒΩAVO: MERACIE PR√çSTROJE (nad sebou) -->
        <div class="t2-card">
          <h3 class="t2-h">Meracie pr√≠stroje</h3>

          <!-- osciloskop -->
          <div class="scope2">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
              <strong>Osciloskop</strong><span class="hint">pripoj obidve sondy</span>
            </div>
            <div class="scope-screen"><canvas id="t2-wave"></canvas></div>
            <div class="dmm-reading" id="t2-scope-rdg" style="margin-top:8px">nepripojen√©</div>
            <div class="jacks">
              <div class="jack red"   draggable="true" data-probe="scopeA"><span class="dot"></span> ƒçerven√° sonda</div>
              <div class="jack black" draggable="true" data-probe="scopeB"><span class="dot"></span> ƒçierna sonda</div>
            </div>
            <div class="dropzone" id="dz-scope"></div>
          </div>

          <!-- multimeter -->
          <div class="dmm" style="margin-top:14px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
              <strong>Multimeter</strong><span class="hint">pripoj ≈°n√∫ry a zvoƒæ rozsah</span>
            </div>
            <div class="dmm-face">
              <div class="dmm-reading" id="t2-dmm-rdg">--.- V</div>
              <div>
                <div class="selector" id="sel" style="--angle:-20deg"></div>
                <div class="sel-row" style="margin-top:8px">
                  <button class="sel-btn" data-mode="ACV">V~</button>
                  <button class="sel-btn" data-mode="DCV">V‚éì</button>
                  <button class="sel-btn" data-mode="ACA">A~</button>
                  <button class="sel-btn" data-mode="DCA">A‚éì</button>
                  <button class="sel-btn" data-mode="OHM">Œ©</button>
                </div>
              </div>
            </div>
            <div class="jacks">
              <div class="jack red"   draggable="true" data-probe="dmmV"><span class="dot"></span> V/Œ©</div>
              <div class="jack black" draggable="true" data-probe="dmmCOM"><span class="dot"></span> COM</div>
              <div class="jack amper" draggable="true" data-probe="dmmA"><span class="dot"></span> A</div>
            </div>
            <div class="dropzone" id="dz-dmm"></div>
          </div>
        </div>

        <!-- PRAVO: KARTIƒåKY + OBVOD -->
        <div class="t2-card">
          <h3 class="t2-h">Priraƒè, ƒço zobrazuje ktor√Ω pr√≠stroj</h3>

          <!-- pole s kartiƒçkami NAD obvodom -->
          <div class="tray" id="t2-tray">
            <div class="token" draggable="true" data-token="u(t)">u(t)</div>
            <div class="token" draggable="true" data-token="Um">U<sub>m</sub></div>
            <div class="token" draggable="true" data-token="U">U</div>
          </div>
          <p class="hint" style="margin-top:4px;margin-bottom:8px">
            Potiahni kartiƒçky na <b>Osciloskop</b> alebo <b>Multimeter</b>.
            Osciloskop zobrazuje ƒçasov√Ω priebeh, multimeter efekt√≠vnu hodnotu.
          </p>

          <h3 class="t2-h" style="margin-top:4px">Obvod: zdroj ‚Äì ≈æiarovka</h3>
          <div class="circuit">
            <div class="lamp off" id="t2-lamp"></div>

            <!-- svorky + ich popis -->
            <div class="terminal tA" data-terminal="A" title="svorka A"></div>
            <div class="terminal tB" data-terminal="B" title="svorka B"></div>
            <div class="termLabel labA">A</div>
            <div class="termLabel labB">B</div>

            <div class="source">
              <div class="src-post pos" title="+ zdroj"></div>
              <div style="font-weight:700;color:#334155">LAB AC SOURCE</div>
              <div class="src-post neg" title="‚àí zdroj"></div>
            </div>
            <button class="t2-btn" id="t2-reset">Reset pripojen√≠</button>
          </div>

          <p class="hint" style="margin-top:8px">
            √öloha 2: Pripoj sondy osciloskopu a multimetra na svorky
            <b>A</b> a <b>B</b>. Potom rozhodni, ktor√Ω pr√≠stroj zobrazuje
            <b>u(t)</b>, ktor√Ω <b>U<sub>m</sub></b> a kde patr√≠ efekt√≠vna hodnota
            <b>U</b>. Kartiƒçky priraƒè tak, aby aspo≈à dve boli umiestnen√© spr√°vne.
          </p>
        </div>

      </div>
    </section>

    <section id="task3" class="task-screen">
  <section class="play">
    <div class="workbench">
      <div class="t3-cols">

        <!-- ƒΩAVO ‚Äì S√çNUS -->
        <div class="t3-waveBox">
          <div class="t3-title">ƒåasov√Ω priebeh u(t)</div>

          <div class="t3-plot" id="t3-plot">
            <canvas id="t3-wave"></canvas>

            <div class="t3-cursor-v" id="t3-cv">
              <span class="t3-tag" id="t3-cv-tag">œât ‚âà 0¬∞</span>
            </div>

            <div class="t3-cursor-h" id="t3-ch">
              <span class="t3-tag" id="t3-ch-tag">U ‚âà 0 V</span>
            </div>

            <div class="t3-axes-labels">
              <span>U [V]</span>
              <span>œâ¬∑t [¬∞]</span>
            </div>
          </div>
        </div>

        <!-- PRAVO ‚Äì F√ÅZOR -->
        <div class="t3-phasorBox">
          <div class="t3-title">F√°zor nap√§tia</div>
          <canvas id="t3-phasor"></canvas>

          <div class="t3-sliders">

            <div><b>Vp√≠≈° odpoveƒè:</b></div>

            <label>
              U<sub>m</sub>:
              <input type="number" id="t3-Um-num" step="1" value="0">
              <span>V</span>
            </label>

            <label>
              œà<sub>u</sub>:
              <input type="number" id="t3-psi-num" step="1" value="0">
              <span>¬∞</span>
            </label>
          </div>

          <button id="t3-check" class="t3-checkBtn" style="align-self:flex-end;">
            Skontrolova≈•
          </button>

          <div id="t3-feedback" class="t3-feedback"></div>
        </div>

      </div>
    </div>
  </section>
</section>

    <!-- HUD -->
    <section class="hud">
      <div class="group">
        <span class="pill" id="timePill">TIME: 00:00</span>
        <span class="pill">
          MODE:
          <select id="modeSelect" style="margin-left:6px">
            <option value="EASY" selected>EASY</option>
            <option value="MEDIUM">MEDIUM</option>
            <option value="HARD">HARD</option>
          </select>
        </span>
        <span class="pill" id="mistakesPill">MISTAKES: 0/2</span>
        <span class="pill" id="locksPill">LOCKS LEFT: 10</span>
        <span class="pill" id="hintText"></span>
      </div>
      <div class="group">
        <button class="pill" id="hintBtn">HINT</button>
      </div>
    </section>
  </main>

  <script>
    // bublina
    document.getElementById('bubbleClose').onclick =
      () => document.getElementById('bubble').style.display='none';

    // HUD / stav
    const pills={
      mistakes:document.getElementById('mistakesPill'),
      locks:document.getElementById('locksPill'),
      time:document.getElementById('timePill')
    };
    const state={
      mode:'EASY',mistakes:0,
      U:230,f:50,psi:10,tGiven:2.0,
      playing:false,tAnim:2.0
    };
    const el={
      taskText:document.getElementById('taskText'),
      tSlider:document.getElementById('tSlider'),
      tRead:document.getElementById('tReadout'),
      play:document.getElementById('playBtn'),
      answer:document.getElementById('answer'),
      check:document.getElementById('checkBtn'),
      feedback:document.getElementById('feedback'),
      taskPanel:document.getElementById('taskPanel'),
      bubble:document.getElementById('bubble'),
      osc:document.getElementById('osc'),
      spark:document.getElementById('spark'),
      locksCol:document.getElementById('locksCol'),
      modeSelect:document.getElementById('modeSelect')
    };

    const TAU=Math.PI*2,
          deg2rad=d=>d*Math.PI/180,
          rad2deg=r=>r*180/Math.PI,
          round2=x=>Math.round(x*100)/100,
          randFrom=a=>a[Math.floor(Math.random()*a.length)];
  // √öLOHA 3 ‚Äì povolen√© f√°zy (¬±5¬∞, ¬±10¬∞, ..., ¬±85¬∞) a "virtu√°lna" frekvencia
  const T3_PSI_CHOICES = (() => {
  const arr = [];
  for(let phi = 5; phi <= 85; phi += 5){
    arr.push(phi, -phi);
  }
  return arr;
})();
const T3_F = 50; // Hz ‚Äì horizont√°lna os je œât [¬∞] pre f = 50 Hz

    function tolByMode(){
      return state.mode==='EASY'?0.50 :
             state.mode==='MEDIUM'?0.20 : 0.05;
    }

    // prep√≠nanie √∫loh
    function showTask(id){
      document.querySelectorAll('.task-screen').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.getElementById('btnTask1').classList.toggle('active',id==='task1');
      document.getElementById('btnTask2').classList.toggle('active',id==='task2');
      document.getElementById('btnTask3').classList.toggle('active',id==='task3');

      if(id==='task1'){
        resizeOsc();
        newTask1();
      }
      if(id==='task2'){
        t2_init();
        el.taskText.innerHTML =
          '√öloha 2: Pripoj sondy osciloskopu a multimetra na svorky <b>A</b> a <b>B</b>. '+
          'Potom rozhodni, ktor√Ω pr√≠stroj meria okam≈æit√∫ hodnotu <var>u(t)</var>, ktor√Ω '+
          'amplit√∫du <var>U<sub>m</sub></var> a kde patr√≠ efekt√≠vna hodnota <var>U</var>.';
      }
      if(id==='task3'){
        t3_init();
        newTask3();
      }
    }

    function updateHud(){
      const left=el.locksCol.querySelectorAll('.lock').length;
      pills.mistakes.textContent=`MISTAKES: ${state.mistakes}/2`;
      pills.locks.textContent   =`LOCKS LEFT: ${left}`;
    }
    function failFeedback(){
      el.taskPanel.classList.add('shake','flash');
      setTimeout(()=>el.taskPanel.classList.remove('shake','flash'),450);
    }
    function showMuhaha(){
      el.bubble.style.display='block';
      el.bubble.innerHTML='MUHAHA! Nov√© zadanie‚Ä¶<div class="close" id="bubbleClose2">√ó</div>';
      document.getElementById('bubbleClose2').onclick=
        ()=>el.bubble.style.display='none';
    }
    function dropOneLock(){
      const locks=el.locksCol.querySelectorAll('.lock');
      if(locks.length) locks[0].remove();
    }

    // nov√© zadanie ‚Äì √öLOHA 1
    function newTask1(){
      state.mistakes=0;
      state.U=randFrom([230,120,100,60]);
      state.f=50;
      state.psi=randFrom([-30,-15,0,10,15,30]);
      const Tms=1000/state.f;
      state.tGiven=+(Math.random()*Tms).toFixed(1);
      el.taskText.innerHTML =
        `Vypoƒç√≠taj <var>u</var>(<var>t</var>) v ƒçase ${state.tGiven.toFixed(1)} ms.`+
        `<br>Vzorec: <var>u</var>(<var>t</var>) = <var>U</var><sub>m</sub> sin(<var>œât</var> + <span class="psi">œà</span>), `+
        `kde <var>U</var><sub>m</sub> = ‚àö2¬∑<var>U</var>.`+
        `<br>Parametre: <var>U</var> = ${state.U} V, <var>f</var> = ${state.f} Hz, `+
        `<span class="psi">œà</span> = ${state.psi}¬∞.`;      
      el.tSlider.max=Tms.toFixed(1);
      el.tSlider.value=state.tGiven;
      el.tRead.textContent=state.tGiven.toFixed(1)+' ms';
      state.tAnim=state.tGiven;
      el.answer.value='';
      el.feedback.textContent='';
      document.getElementById('hintText').textContent='';
      drawOsc();
      updateHud();
    }
    function u_of_t_ms(tms){
      const Um=Math.SQRT2*state.U,
            w=TAU*state.f,
            t=tms/1000,
            psi=deg2rad(state.psi);
      return Um*Math.sin(w*t+psi);
    }

    /* OSCILOSKOP ‚Äì √öLOHA 1 */
    let oscCtx=null,DPR=window.devicePixelRatio||1,rafId=null,lastTs=0,audioCtx=null;
    function resizeOsc(){
      const r=el.osc.getBoundingClientRect();
      el.osc.width=Math.floor(r.width*DPR);
      el.osc.height=Math.floor(r.height*DPR);
      oscCtx=el.osc.getContext('2d');
    }
    const SCOPE_STYLE={
      gridFine:'rgba(255,255,255,0.22)',
      gridBold:'rgba(255,255,255,0.38)',
      axis:'#f9fafb',axisW:2.6,sineW:2.4
    };
    function drawOsc(){
      if(!oscCtx) resizeOsc();
      const W=el.osc.width/DPR,H=el.osc.height/DPR;
      const ctx=oscCtx;
      ctx.save();ctx.scale(DPR,DPR);ctx.clearRect(0,0,W,H);
      const G=20,PAD=2*G,
            xmin=PAD,xmax=W-PAD,
            ymin=PAD,ymax=H-PAD,
            midX=(xmin+xmax)/2,midY=(ymin+ymax)/2;
      // mrie≈æka
      ctx.lineWidth=1;ctx.strokeStyle=SCOPE_STYLE.gridFine;
      for(let x=Math.ceil(xmin/G)*G;x<=xmax;x+=G){
        ctx.beginPath();ctx.moveTo(x,ymin);ctx.lineTo(x,ymax);ctx.stroke();
      }
      for(let y=Math.ceil(ymin/G)*G;y<=ymax;y+=G){
        ctx.beginPath();ctx.moveTo(xmin,y);ctx.lineTo(xmax,y);ctx.stroke();
      }
      const G10=10*G;
      ctx.lineWidth=1.4;ctx.strokeStyle=SCOPE_STYLE.gridBold;
      for(let x=Math.ceil(xmin/G10)*G10;x<=xmax;x+=G10){
        ctx.beginPath();ctx.moveTo(x,ymin);ctx.lineTo(x,ymax);ctx.stroke();
      }
      for(let y=Math.ceil(ymin/G10)*G10;y<=ymax;y+=G10){
        ctx.beginPath();ctx.moveTo(xmin,y);ctx.lineTo(xmax,y);ctx.stroke();
      }
      // osi
      ctx.strokeStyle=SCOPE_STYLE.axis;ctx.lineWidth=SCOPE_STYLE.axisW;
      ctx.beginPath();ctx.moveTo(xmin,midY);ctx.lineTo(xmax,midY);ctx.stroke();
      ctx.beginPath();ctx.moveTo(midX,ymin);ctx.lineTo(midX,ymax);ctx.stroke();
      // sinus
      const T=1/state.f,viewT=2*T,
            tToX=t=>xmin+(t/viewT)*(xmax-xmin),
            A=(ymax-ymin)*0.28,
            psi=deg2rad(state.psi),w=TAU*state.f;
      ctx.strokeStyle='#22c55e';ctx.lineWidth=SCOPE_STYLE.sineW;
      ctx.beginPath();
      const STEPS=Math.max(240,Math.floor(xmax-xmin));
      for(let i=0;i<=STEPS;i++){
        const x=xmin+(i/STEPS)*(xmax-xmin);
        const t=((x-xmin)/(xmax-xmin))*viewT;
        const y=midY-A*Math.sin(w*t+psi);
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.stroke();
      // bodka
      const Tms=1000/state.f;
      const tms=state.playing?state.tAnim:+el.tSlider.value;
      const t=(tms/1000)%viewT;
      const bx=tToX(t);
      const by=midY-A*Math.sin(w*t+psi);
      ctx.fillStyle='#a7f3d0';
      ctx.beginPath();ctx.arc(bx,by,4,0,TAU);ctx.fill();
      ctx.restore();
    }
    function loop(ts){
      if(!state.playing){rafId=null;return;}
      if(!lastTs) lastTs=ts;
      const dt=(ts-lastTs)/1000;lastTs=ts;
      const Tms=1000/state.f;
      state.tAnim+=dt*500;
      if(state.tAnim>=Tms){state.tAnim-=Tms;beep();}
      el.tSlider.value=state.tAnim.toFixed(1);
      el.tRead.textContent=el.tSlider.value+' ms';
      drawOsc();
      rafId=requestAnimationFrame(loop);
    }
    el.play.onclick=()=>{
      state.playing=!state.playing;
      el.play.textContent=state.playing?'‚è∏Ô∏é Pause':'‚ñ∂Ô∏é Play';
      el.play.classList.toggle('paused',!state.playing);
      if(state.playing){lastTs=0;rafId=requestAnimationFrame(loop);}
      else if(rafId){cancelAnimationFrame(rafId);rafId=null;}
    };
    addEventListener('resize',()=>{resizeOsc();drawOsc();});
    el.tSlider.oninput=e=>{
      const v=+e.target.value;
      el.tRead.textContent=v.toFixed(1)+' ms';
      if(!state.playing) state.tAnim=v;
      drawOsc();
    };
    function beep(){
      if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
      const o=audioCtx.createOscillator(),g=audioCtx.createGain();
      o.type='sine';o.frequency.value=880;g.gain.value=0.04;
      o.connect(g).connect(audioCtx.destination);
      o.start();o.stop(audioCtx.currentTime+0.08);
    }

    // kontrola odpovede ‚Äì √öLOHA 1
    el.check.onclick = () => {
      const raw = el.answer.value.trim().replace(',', '.');
      const ans = parseFloat(raw);

      if (!Number.isFinite(ans)) {
        el.feedback.textContent = 'Zadaj ƒç√≠slo (V).';
        el.feedback.style.color = '#ef4444';
        return;
      }

      const correctGiven  = u_of_t_ms(state.tGiven);
      const currentTms    = +el.tSlider.value;
      const correctSlider = u_of_t_ms(currentTms);

      const diffGiven  = Math.abs(ans - correctGiven);
      const diffSlider = Math.abs(ans - correctSlider);
      const diff = Math.min(diffGiven, diffSlider);
      const correct = (diffGiven <= diffSlider) ? correctGiven : correctSlider;

      const baseTol = tolByMode();
      const relTol  = Math.abs(correct) * 0.01;
      const tol = Math.max(baseTol, relTol);

      if (diff <= tol) {
        el.feedback.textContent = `Spr√°vne! u(t) ‚âà ${round2(correct).toFixed(2)} V üîì`;
        el.feedback.style.color = '#16a34a';
        dropOneLock();
        document.getElementById('hintText').textContent='';
        newTask1();
      } else {
        state.mistakes++;

        if (state.mode === 'EASY' && state.mistakes === 1) {
          document.getElementById('hintText').textContent =
            'N√°poveda: U_m = ‚àö2¬∑U, œâ = 2œÄf, t v sekund√°ch.';
          el.feedback.textContent = 'Sk√∫s e≈°te raz. Pozri n√°povedu dole.';
          el.feedback.style.color = '#b45309';
        } else if (state.mistakes >= 2) {
          el.feedback.textContent = 'MUHAHA! Nov√© zadanie.';
          el.feedback.style.color = '#ef4444';
          document.getElementById('hintText').textContent='';
          showMuhaha();
          newTask1();
        } else {
          el.feedback.textContent = 'Sk√∫s e≈°te raz.';
          el.feedback.style.color = '#ef4444';
        }

        failFeedback();
      }

      updateHud();
    };

    el.modeSelect.onchange=e=>{state.mode=e.target.value;};
    const startTs=Date.now();
    setInterval(()=>{
      const s=Math.floor((Date.now()-startTs)/1000);
      const m=String(Math.floor(s/60)).padStart(2,'0');
      const ss=String(s%60).padStart(2,'0');
      pills.time.textContent=`TIME: ${m}:${ss}`;
    },1000);

    /* KALKULAƒåKA ‚Äì √öLOHA 1 */
    const calc = {
      disp: document.getElementById('calcDisplay'),
      modeBtn: document.getElementById('degRad'),
      grid: document.querySelector('.calc-grid'),
      rad: true
    };

    calc.modeBtn.onclick = () => {
      calc.rad = !calc.rad;
      calc.modeBtn.textContent = calc.rad ? 'RAD' : 'DEG';
      calc.modeBtn.title = calc.rad ? 'Radi√°ny' : 'Stupne';
    };

    function insertToDisplay(s){
      calc.disp.value += s;
      calc.disp.focus();
    }
    function delOne(){
      calc.disp.value = calc.disp.value.slice(0,-1);
    }
    function clearDisp(){
      calc.disp.value = '';
    }

    function evalExpr(){
      let expr = calc.disp.value
        .replace(/,/g,'.')
        .replace(/\^/g,'**')
        .replace(/œÄ/g,Math.PI.toString());

      const wrapTrig = fn => (calc.rad ? fn : x => fn(x*Math.PI/180));

      const scope = {
        sin:x=>wrapTrig(Math.sin)(x),
        cos:x=>wrapTrig(Math.cos)(x),
        tan:x=>wrapTrig(Math.tan)(x),
        sqrt:Math.sqrt
      };

      try{
        const f = new Function('sin','cos','tan','sqrt',`return (${expr})`);
        const val = f(scope.sin,scope.cos,scope.tan,scope.sqrt);
        return Number.isFinite(val) ? val : NaN;
      }catch(e){
        return NaN;
      }
    }

    calc.grid.addEventListener('click', e=>{
      const b = e.target.closest('button'); if(!b) return;
      const num = b.getAttribute('data-num');
      const op  = b.getAttribute('data-op');
      const fn  = b.getAttribute('data-fn');

      if(num !== null){
        insertToDisplay(num);
        return;
      }

      if(op !== null){
        if(op === ',') insertToDisplay(',');
        else insertToDisplay(op);
        return;
      }

      if(!fn) return;

      if(fn === 'pi'){
        insertToDisplay('œÄ');
      }
      else if(fn === 'tenpow'){
        const s = calc.disp.value;
        const needsMul = /[0-9)\]]$/.test(s);
        insertToDisplay((needsMul ? '*10^(' : '10^('));
      }
      else if(fn === 'sin' || fn === 'cos' || fn === 'tan' || fn === 'sqrt'){
        insertToDisplay(fn + '(');
      }
      else if(fn === 'back'){
        delOne();
      }
      else if(fn === 'clear'){
        clearDisp();
      }
      else if(fn === 'mode'){
        calc.modeBtn.onclick();
      }
      else if(fn === 'pm'){
        const v = calc.disp.value.trim();
        if(v === ''){
          insertToDisplay('-');
        }else if(!Number.isNaN(Number(v))){
          calc.disp.value = String(-Number(v));
        }else{
          insertToDisplay('-');
        }
      }
      else if(fn === 'eq'){
        const v = evalExpr();
        calc.disp.value = Number.isFinite(v) ? v : 'NaN';
      }
      else if(fn === 'ans'){
        const v = evalExpr();
        if(Number.isFinite(v)){
          document.getElementById('answer').value = round2(v).toFixed(2);
        }
      }
    });

    /* √öLOHA 2 ‚Äì inicializ√°cia */
    let t2Ready=false;
    function t2_init(){
      if(t2Ready) return;
      t2Ready=true;

      const UeffOptions=[40,60,110,230];
      const Ueff=UeffOptions[Math.floor(Math.random()*UeffOptions.length)];
      const f=50;

      let connMap={},scopeConnected={A:false,B:false},dmmConnected={V:false,COM:false,A:false};
      let dmmMode='ACV';

      const modeAngles={ACV:-20,DCV:20,ACA:90,DCA:130,OHM:-90};
      const sel=document.getElementById('sel');

      // prep√≠naƒç rozsahu multimetra
      document.querySelectorAll('.sel-btn').forEach(b=>{
        b.onclick=()=>{
          dmmMode=b.dataset.mode;
          sel.style.setProperty('--angle',modeAngles[dmmMode]+'deg');
          document.querySelectorAll('.sel-btn')
            .forEach(x=>x.classList.toggle('active',x===b));
          refreshInstruments();
        };
      });
      document.querySelector('.sel-btn[data-mode="ACV"]').click();

      // sondy ‚Äì drag z jackov na svorky A/B
      const probes=[...document.querySelectorAll('#t2 .jack')];
      probes.forEach(p=>{
        p.addEventListener('dragstart',e=>{
          e.dataTransfer.setData('text/probe',p.dataset.probe);
        });
      });

      const terms=[...document.querySelectorAll('#t2 .terminal')];
      terms.forEach(t=>{
        t.addEventListener('dragover',e=>e.preventDefault());
        t.addEventListener('drop',e=>{
          e.preventDefault();
          const pid=e.dataTransfer.getData('text/probe');if(!pid) return;
          connMap[pid]=t.dataset.terminal;

          scopeConnected.A=(connMap['scopeA']==='A'||connMap['scopeB']==='A');
          scopeConnected.B=(connMap['scopeA']==='B'||connMap['scopeB']==='B');
          dmmConnected.V  =(connMap['dmmV']  ==='A'||connMap['dmmV']  ==='B');
          dmmConnected.COM=(connMap['dmmCOM']==='A'||connMap['dmmCOM']==='B');
          dmmConnected.A  =(connMap['dmmA']  ==='A'||connMap['dmmA']  ==='B');

          refreshInstruments();
        });
      });

      // reset ‚Äì odpoj√≠ sondy aj vyƒçist√≠ kartiƒçky
      document.getElementById('t2-reset').onclick=()=>{
        connMap={};
        scopeConnected={A:false,B:false};
        dmmConnected={V:false,COM:false,A:false};
        document.getElementById('dz-scope').innerHTML='';
        document.getElementById('dz-dmm').innerHTML='';
        document.getElementById('dz-scope').classList.remove('dz-ok','dz-bad');
        document.getElementById('dz-dmm').classList.remove('dz-ok','dz-bad');
        refreshInstruments();
      };

      // osciloskop 2 ‚Äì animovan√° s√≠nusovka
      const cvs=document.getElementById('t2-wave');
      const ctx=cvs.getContext('2d');
      function resizeScope2(){
        const r=cvs.getBoundingClientRect();
        const DPR2=window.devicePixelRatio||1;
        cvs.width=Math.floor(r.width*DPR2);
        cvs.height=Math.floor(r.height*DPR2);
        ctx.setTransform(DPR2,0,0,DPR2,0,0);
      }
      resizeScope2();
      addEventListener('resize',resizeScope2);

      function drawScope2(){
        const w=cvs.clientWidth,h=cvs.clientHeight;
        ctx.clearRect(0,0,w,h);
        const PAD=16,xmin=PAD,xmax=w-PAD,ymin=PAD,ymax=h-PAD,midY=(ymin+ymax)/2,midX=(xmin+xmax)/2;
        ctx.strokeStyle='rgba(255,255,255,.85)';ctx.lineWidth=2;
        ctx.beginPath();ctx.moveTo(xmin,midY);ctx.lineTo(xmax,midY);ctx.stroke();
        ctx.beginPath();ctx.moveTo(midX,ymin);ctx.lineTo(midX,ymax);ctx.stroke();
        const ok=scopeConnected.A&&scopeConnected.B;
        if(ok){
          const A=(ymax-ymin)*0.35,steps=Math.max(240,Math.floor(xmax-xmin)),tau=Math.PI*2,tt=performance.now()/1000;
          ctx.strokeStyle='#22c55e';ctx.lineWidth=2.2;ctx.beginPath();
          for(let i=0;i<=steps;i++){
            const x=xmin+(i/steps)*(xmax-xmin);
            const t=(i/steps)*2*(1/f);
            const y=midY-A*Math.sin(tau*f*t+tt*2.0);
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
          }
          ctx.stroke();
          document.getElementById('t2-scope-rdg').textContent='≈æiv√° vlna‚Ä¶';
        }else{
          document.getElementById('t2-scope-rdg').textContent='nepripojen√©';
        }
        requestAnimationFrame(drawScope2);
      }
      requestAnimationFrame(drawScope2);

      // kartiƒçky u(t), Um, U ‚Äì drag na dropz√≥ny
      const tray=document.getElementById('t2-tray');
      tray.addEventListener('dragstart',e=>{
        const t=e.target.closest('.token');if(!t) return;
        e.dataTransfer.setData('text/token',t.dataset.token);
        e.dataTransfer.setData('text/id',t.outerHTML);
      });

      const dzScope=document.getElementById('dz-scope');
      const dzDmm=document.getElementById('dz-dmm');

      function setupDz(dz){
        dz.addEventListener('dragover',e=>e.preventDefault());
        dz.addEventListener('drop',e=>{
          e.preventDefault();
          const tok=e.dataTransfer.getData('text/token');if(!tok) return;
          const already=[...dz.querySelectorAll('.token')].some(t=>t.dataset.token===tok);
          if(already) return;
          const html=e.dataTransfer.getData('text/id');
          dz.insertAdjacentHTML('beforeend',html);
          checkAssignments();
        });
      }
      setupDz(dzScope);
      setupDz(dzDmm);

      function checkAssignments(){
        const tScope=[...dzScope.querySelectorAll('.token')].map(t=>t.dataset.token);
        const tDmm  =[...dzDmm.querySelectorAll('.token')].map(t=>t.dataset.token);

        const scopeOk = tScope.length>0 &&
                        (tScope.includes('u(t)') || tScope.includes('Um')) &&
                        !tScope.includes('U');

        const dmmOk   = tDmm.length>0 &&
                        tDmm.includes('U') &&
                        tDmm.every(x=>x==='U');

        dzScope.classList.toggle('dz-ok',scopeOk);
        dzScope.classList.toggle('dz-bad',tScope.length>0 && !scopeOk);
        dzDmm.classList.toggle('dz-ok',dmmOk);
        dzDmm.classList.toggle('dz-bad',tDmm.length>0 && !dmmOk);

        if(scopeOk && dmmOk){
          setTimeout(()=>alert('Spr√°vne! Osciloskop ‚Üí u(t), U_m; Multimeter ‚Üí Uef.'),150);
        }
      }

      function refreshInstruments(){
        const lamp=document.getElementById('t2-lamp');
        const dmmLbl=document.getElementById('t2-dmm-rdg');

        const sOK=scopeConnected.A&&scopeConnected.B;
        const vOK=dmmConnected.V&&dmmConnected.COM;
        const aOK=dmmConnected.A&&dmmConnected.COM;

        lamp.classList.toggle('off',!(sOK||vOK||aOK));

        let txt='--.-',unit='V';
        if(dmmMode==='ACV'){unit='V';txt=vOK?Ueff.toFixed(1):'--.-';}
        else if(dmmMode==='DCV'){unit='V';txt=vOK?'0.0':'--.-';}
        else if(dmmMode==='OHM'){unit='Œ©';txt=vOK?'‚àû':'--';}
        else if(dmmMode==='ACA'){unit='A';txt=aOK?'??':'--';}
        else if(dmmMode==='DCA'){unit='A';txt=aOK?'0.00':'--';}
        dmmLbl.textContent=`${txt} ${unit}`;
      }
      refreshInstruments();
    }

    /* √öLOHA 3 ‚Äì f√°zory v re√°lnom ƒçase */
    let t3State = {
  Um: 80,
  psi: 0,
  ymin: -120,
  ymax: 120
};

const T3_PSI_CHOICES = (() => {
  const arr = [];
  for(let p = 5; p <= 85; p += 5){
    arr.push(p, -p);
  }
  return arr;
})();


function drawT3Wave(){
  const c = document.getElementById('t3-wave');
  const ctx = c.getContext('2d');
  const box = document.getElementById('t3-plot');

  const r = box.getBoundingClientRect();
  const DPR = devicePixelRatio || 1;
  c.width = r.width*DPR;
  c.height = r.height*DPR;
  ctx.setTransform(DPR,0,0,DPR,0,0);

  const w = r.width;
  const h = r.height;

  const phiMin = -90;
  const phiMax = 630;

  ctx.clearRect(0,0,w,h);

  const midY = h/2;
  const span = phiMax - phiMin;

  // osi
  ctx.strokeStyle='#fff';
  ctx.lineWidth=2;

  const x0 = w*((0-phiMin)/span);
  ctx.beginPath();ctx.moveTo(x0,0);ctx.lineTo(x0,h);ctx.stroke();
  ctx.beginPath();ctx.moveTo(0,midY);ctx.lineTo(w,midY);ctx.stroke();

  // s√≠nus ‚Äì pln√° ƒçiara
  ctx.strokeStyle='#22c55e';
  ctx.lineWidth=2;
  ctx.setLineDash([]);

  ctx.beginPath();
  for(let i=0;i<w;i++){
    const phi = phiMin + (i/w)*span;
    const y = midY - (t3State.Um)*Math.sin(deg2rad(phi + t3State.psi));
    if(i===0) ctx.moveTo(i,y); else ctx.lineTo(i,y);
  }
  ctx.stroke();

  // kurzory ‚Äì ≈°tart na ¬Ω ≈°tvorƒçeka
  const cv = document.getElementById('t3-cv');
  const ch = document.getElementById('t3-ch');

  cv.style.left = `${x0 - 10}px`;
  ch.style.top  = `${midY + 10}px`;
}

function drawT3Phasor(){
  const c = document.getElementById('t3-phasor');
  const ctx = c.getContext('2d');

  const r = c.parentElement.getBoundingClientRect();
  const size = r.height * 0.75;

  const DPR = devicePixelRatio || 1;
  c.width = r.width*DPR;
  c.height = size*DPR;
  ctx.setTransform(DPR,0,0,DPR,0,0);

  const w = r.width;
  const h = size;
  const cx = w/2;
  const cy = h/2;

  ctx.clearRect(0,0,w,h);

  // osi
  ctx.strokeStyle='#fff';
  ctx.beginPath();ctx.moveTo(0,cy);ctx.lineTo(w,cy);ctx.stroke();
  ctx.beginPath();ctx.moveTo(cx,0);ctx.lineTo(cx,h);ctx.stroke();

  // f√°zor
  const UmInput = Number(document.getElementById('t3-Um-num').value||0);
  const psiInput = Number(document.getElementById('t3-psi-num').value||0);

  const len = (UmInput/150)*(h*0.45);
  const ang = deg2rad(-psiInput);
  const x = cx + len*Math.cos(ang);
  const y = cy + len*Math.sin(ang);

  ctx.strokeStyle='#22c55e';
  ctx.lineWidth=3;
  ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(x,y);ctx.stroke();
}

document.getElementById('t3-check').onclick = () => {
  const Um = Number(document.getElementById('t3-Um-num').value);
  const psi = Number(document.getElementById('t3-psi-num').value);

  const okUm = Math.abs(Um - t3State.Um) <= 2;
  const okPsi = Math.abs(psi - t3State.psi) <= 2;

  const fb = document.getElementById('t3-feedback');

  if(okUm && okPsi){
    fb.textContent='‚úÖ Tak to je! Tvoja ≈°√≠pka zasiahla jadro vedomost√≠!';
    fb.style.color='#22c55e';
  }else{
    if(Math.abs(psi)>100) fb.textContent='Tento uhol je v√§ƒç≈°√≠ ako moja trpezlivos≈•!';
    else fb.textContent='Radi√°n a stupe≈à nie s√∫ len tak jedno! Men√≠m zadanie.';
    fb.style.color='#ef4444';
  }

  drawT3Phasor();
};

window.addEventListener('Resize',()=>{
  drawT3Wave();
  drawT3Phasor();
});

      function drawT3Wave(){
        if(!t3WaveCtx) return;
        const ctx=t3WaveCtx;
        const w=t3WaveCanvas.clientWidth;
        const h=t3WaveCanvas.clientHeight;
        ctx.clearRect(0,0,w,h);

        const PADX=40, PADY=20;
        const xmin=PADX,xmax=w-10;
        const ymin=PADY,ymax=h-PADY;
        const midY=(ymin+ymax)/2;

        // rozsah uhlov: od -90¬∞ do 630¬∞ (2 peri√≥dy + kus pred nulou)
        const phiMin=-90, phiMax=630;
        const span=phiMax-phiMin;

        // mrie≈æka ‚Äì vertik√°lne ka≈æd√Ωch 90¬∞
        ctx.strokeStyle='rgba(148,163,184,.25)';
        ctx.lineWidth=1;
        for(let xDeg=-90;xDeg<=630;xDeg+=90){
          const px=xmin + ((xDeg-phiMin)/span)*(xmax-xmin);
          ctx.beginPath();ctx.moveTo(px,ymin);ctx.lineTo(px,ymax);ctx.stroke();
        }
        // horizont√°lne l√≠nie po 20 V
        const yStep=20;
        for(let y=-100;y<=100;y+=yStep){
          const py=midY - (y/(t3State.ymax))*((ymax-ymin)/2);
          ctx.beginPath();ctx.moveTo(xmin,py);ctx.lineTo(xmax,py);ctx.stroke();
        }

        // osi ‚Äì U=0 a œât=0
        ctx.setLineDash([]);
        ctx.strokeStyle='#e5e7eb';ctx.lineWidth=1.6;
        // U=0
        ctx.beginPath();ctx.moveTo(xmin,midY);ctx.lineTo(xmax,midY);ctx.stroke();
        // œât=0
        const x0=xmin + ((0-phiMin)/span)*(xmax-xmin);
        ctx.beginPath();ctx.moveTo(x0,ymin);ctx.lineTo(x0,ymax);ctx.stroke();

        // s√≠nusovka: u = Um*sin(œÜ+œà)
        ctx.setLineDash([4,4]);
        ctx.strokeStyle='#22c55e';ctx.lineWidth=2;
        ctx.beginPath();
        const steps=span;
        for(let i=0;i<=steps;i++){
          const phi=phiMin + (i/steps)*span;
          const rad=deg2rad(phi + t3State.psi);
          const u=t3State.Um*Math.sin(rad);
          const x=xmin + ((phi-phiMin)/span)*(xmax-xmin);
          const y=midY - (u/(t3State.ymax))*((ymax-ymin)/2);
          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.stroke();
        ctx.setLineDash([]);
      }
      function drawT3Phasor(){
        if(!t3PhCtx) return;
        const ctx=t3PhCtx;
        const w=t3PhCanvas.clientWidth;
        const h=t3PhCanvas.clientHeight;
        ctx.clearRect(0,0,w,h);

        const cx=w/2, cy=h/2;
        const R=Math.min(w,h)*0.35;

        // osi
        ctx.strokeStyle='rgba(148,163,184,.7)';
        ctx.lineWidth=1.4;
        ctx.beginPath();ctx.moveTo(10,cy);ctx.lineTo(w-10,cy);ctx.stroke();
        ctx.beginPath();ctx.moveTo(cx,10);ctx.lineTo(cx,h-10);ctx.stroke();

        // oznaƒçenie Re, Im
        ctx.fillStyle='rgba(209,213,219,.9)';
        ctx.font='12px system-ui';
        ctx.fillText('Re', w-26, cy-6);
        ctx.fillText('Im', cx+6, 18);

        // kru≈ænica pre referenciu amplit√∫dy (max 150 V)
        ctx.strokeStyle='rgba(55,65,81,.8)';
        ctx.beginPath();ctx.arc(cx,cy,R,0,TAU);ctx.stroke();

        // f√°zor ‚Äì podƒæa nastaven√Ωch sliderov
        const UmSlider=document.getElementById('t3-Um');
        const psiSlider=document.getElementById('t3-psi');
        const UmUser=+UmSlider.value||0;
        const psiUser=deg2rad(+psiSlider.value||0);
        const scale=R/150; // 150 V -> R
        const len=UmUser*scale;

        const ex=cx + len*Math.cos(psiUser);
        const ey=cy - len*Math.sin(psiUser);

        ctx.strokeStyle='#38bdf8';
        ctx.fillStyle='#38bdf8';
        ctx.lineWidth=2.4;
        ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(ex,ey);ctx.stroke();
        // ≈°√≠pka
        const ah=8;
        const ang=psiUser;
        const ax1=ex - ah*Math.cos(ang - Math.PI/8);
        const ay1=ey + ah*Math.sin(ang - Math.PI/8);
        const ax2=ex - ah*Math.cos(ang + Math.PI/8);
        const ay2=ey + ah*Math.sin(ang + Math.PI/8);
        ctx.beginPath();
        ctx.moveTo(ex,ey);ctx.lineTo(ax1,ay1);ctx.lineTo(ax2,ay2);ctx.closePath();ctx.fill();
      }

      resizeT3Canvases();
      addEventListener('resize',resizeT3Canvases);

      // kurzory ‚Äì interaktivita
      let dragging=null;
      t3PlotBox.addEventListener('pointerdown',e=>{
        const rect=t3PlotBox.getBoundingClientRect();
        const cvRect=cv.getBoundingClientRect();
        const chRect=ch.getBoundingClientRect();

        const nearV=Math.abs(e.clientX - (cvRect.left+cvRect.width/2))<10;
        const nearH=Math.abs(e.clientY - (chRect.top+chRect.height/2))<10;

        if(nearV) dragging='v';
        else if(nearH) dragging='h';
      });
      window.addEventListener('pointerup',()=>dragging=null);
      window.addEventListener('pointermove',e=>{
        if(!dragging) return;
        const rect=t3PlotBox.getBoundingClientRect();
        let x=e.clientX-rect.left;
        let y=e.clientY-rect.top;
        const w=rect.width,h=rect.height;

        const PADX=40, PADY=20;
        const xmin=PADX,xmax=w-10;
        const ymin=PADY,ymax=h-PADY;
        const midY=(ymin+ymax)/2;
        const phiMin=-90, phiMax=630;
        const span=phiMax-phiMin;

        if(dragging==='v'){
          if(x<xmin) x=xmin;
          if(x>xmax) x=xmax;
          cv.style.left=`${x}px`;
          const phi=phiMin + ( (x-xmin)/(xmax-xmin) )*span;
          cvTag.textContent=`œât ‚âà ${phi.toFixed(0)}¬∞`;
        }else if(dragging==='h'){
          if(y<ymin) y=ymin;
          if(y>ymax) y=ymax;
          ch.style.top=`${y}px`;
          const u=((midY-y)/( (ymax-ymin)/2 ))*t3State.ymax;
          chTag.textContent=`U ‚âà ${u.toFixed(1)} V`;
        }
      });

      // slider ‚Üî ƒç√≠slo prepojenie
      function linkRangeAndNum(r,n,onChange){
        r.addEventListener('input',()=>{
          n.value=r.value;
          if(onChange) onChange();
        });
        n.addEventListener('input',()=>{
          if(n.value==='') return;
          r.value=n.value;
          if(onChange) onChange();
        });
      }
      linkRangeAndNum(UmSlider,UmNum,drawT3Phasor);
      linkRangeAndNum(psiSlider,psiNum,drawT3Phasor);

      // expose kresliace funkcie
      t3WaveDraw = drawT3Wave;
      t3PhasorDraw = drawT3Phasor;
    }

 function newTask3(){
  state.mistakes = 0;

  // n√°hodn√© zadanie ‚Äì œàu nikdy nie je 0¬∞, v≈ædy n√°sobok 5¬∞
  t3State.Um  = randFrom(T3_UM_CHOICES);
  t3State.psi = randFrom(T3_PSI_CHOICES);
  t3State.ymax = t3State.Um * 1.4;

  el.taskText.innerHTML =
    '√öloha 3: Z vlny urob ≈°√≠pku ‚Äì nech viem, ak√Ω ≈°ok dostane≈°! '+
    'Z grafu ƒçasov√©ho priebehu pomocou posuvn√Ωch kurzorov vyƒç√≠taj '+
    '<var>U</var><sub>m</sub> a poƒçiatoƒçn√∫ f√°zu <span class="psi">œà</span><sub>u</sub>. '+
    'Potom nastav f√°zor napravo tak, aby zodpovedal sign√°lu. '+
    '(Predpokladaj frekvenciu <var>f</var> = ' + T3_F + ' Hz.)';

  const UmSlider = document.getElementById('t3-Um');
  const UmNum    = document.getElementById('t3-Um-num');
  const psiSlider= document.getElementById('t3-psi');
  const psiNum   = document.getElementById('t3-psi-num');

  // v√Ωchodiskov√© hodnoty pre ≈°tudenta: 0 V a 0¬∞
  UmSlider.value  = 0;
  psiSlider.value = 0;
  UmNum.value  = '';
  psiNum.value = '';

  const fb = document.getElementById('t3-feedback');
  fb.textContent = '';
  fb.style.color = '#e5e7eb';

  // prekresli≈• ƒçasov√Ω priebeh (u≈æ pou≈æ√≠va t3State.Um a t3State.psi)
  t3WaveDraw();
  // f√°zor z nulov√Ωch sliderov ‚Äì vektor dƒ∫≈æky 0
  t3PhasorDraw();

  // kurzory nastav√≠me na prieseƒçn√≠k os√≠ (œât = 0, U = 0)
  const plotBox=document.getElementById('t3-plot');
  const rect=plotBox.getBoundingClientRect();
  const cv=document.getElementById('t3-cv');
  const ch=document.getElementById('t3-ch');
  const cvTag=document.getElementById('t3-cv-tag');
  const chTag=document.getElementById('t3-ch-tag');

  const w=rect.width,h=rect.height;
  const PADX=40, PADY=20;
  const xmin=PADX,xmax=w-10;
  const ymin=PADY,ymax=h-PADY;
  const midY=(ymin+ymax)/2;
  const phiMin=-90, phiMax=630;
  const span=phiMax-phiMin;

  const x0 = xmin + ((0 - phiMin) / span) * (xmax - xmin);
  cv.style.left = `${x0}px`;
  cvTag.textContent = 'œât ‚âà 0¬∞';

  const y0 = midY;
  ch.style.top = `${y0}px`;
  chTag.textContent = 'U ‚âà 0.0 V';

  updateHud();
}



    // kontrola ‚Äì √öLOHA 3
    document.getElementById('t3-check').onclick = ()=>{
      const UmUser = parseFloat(document.getElementById('t3-Um-num').value);
      const psiUser = parseFloat(document.getElementById('t3-psi-num').value);
      const fb = document.getElementById('t3-feedback');

      if(!Number.isFinite(UmUser) || !Number.isFinite(psiUser)){
        fb.textContent='Najprv nastav obe hodnoty ‚Äì amplit√∫du aj uhol.';
        fb.style.color='#ef4444';
        return;
      }

      const UmTrue = t3State.Um;
      const psiTrue = t3State.psi;

      const ampOk = Math.abs(UmUser-UmTrue) <= Math.max(3, UmTrue*0.05); // min 3 V alebo 5 %
      const angOk = Math.abs(psiUser-psiTrue) <= 5; // 5¬∞

      if(ampOk && angOk){
        fb.textContent='Tak to je! Tvoja ≈°√≠pka zasiahla jadro vedomost√≠! üîì';
        fb.style.color='#22c55e';
        dropOneLock();
        newTask3();
        return;
      }

      // chyby
      state.mistakes++;

      if(!angOk && ampOk){
        fb.textContent='Tento uhol je v√§ƒç≈°√≠ ako moja trpezlivos≈•!';
      }else if(!ampOk && angOk){
        fb.textContent='Nezamie≈àaj sinus za kosinus a uvid√≠≈° pravdu!';
      }else{
        fb.textContent='‚ÄûRadi√°n a stupe≈à nie s√∫ len tak jedno!‚Äú';
      }
      fb.style.color='#f97316';
      failFeedback();

      if(state.mistakes>=2){
        fb.textContent='Radi√°n a stupe≈à nie s√∫ len tak jedno! Men√≠m zadanie.';
        fb.style.color='#ef4444';
        showMuhaha();
        newTask3();
      }

      updateHud();
    };

   
  </script>
</body>
</html>
